<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í‰ê°€ ì§€í‘œ</title>
    <link
      rel="stylesheet"
      href="{{ str(request.url_for('static', path='css/0_style.css')).replace('http://', 'https://')}}"
    />
    <style>
      .score {
        font-size: 4rem;
        margin-bottom: 30px;
      }
      .result-container {
        background: none;
        border: 2px solid #ff8e03;
        width: 90%;
        margin: auto;
        border-radius: 15px;
      }
      .group {
        position: relative; /* ê²Œì´ì§€ ë°”ë¥¼ ë¶€ëª¨ ìš”ì†Œë¡œ ì„¤ì • */
        display: flex;
        flex-direction: column; /* ìš”ì†Œë“¤ì„ ì„¸ë¡œ ì •ë ¬ */
        align-items: center; /* ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
        text-align: center; /* í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
        margin: 20px 0;
      }

      .group-name {
        font-size: 2em;
        margin-bottom: 10px;
      }
      .progress-bar {
        width: 80%;
        height: 30px;
        background-color: #ddd;
        border-radius: 15px;
        overflow: hidden;
        /* position: relative; âœ… ê²Œì´ì§€ ë°” ë‚´ë¶€ì—ì„œ ìƒëŒ€ ìœ„ì¹˜ ì§€ì • */
      }
      .progress {
        height: 100%;
        /* text-align: center; */
        line-height: 30px;
        color: white;
        transition: width 1s;
      }
      /* ğŸŒŸ ê²Œì´ì§€ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
      .gauge-icon {
        position: absolute;
        top: 20px;
        width: 80px;
        height: 40px;
        transition: left 3s ease-out; /* ë¶€ë“œëŸ¬ìš´ ì´ë™ íš¨ê³¼ */
        z-index: 10; /* âœ… ê²Œì´ì§€ ë°” ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì • */
        opacity: 1; /* âœ… ë³´ì´ê²Œ ì„¤ì • */
        display: block; /* âœ… ë°˜ë“œì‹œ í‘œì‹œë˜ë„ë¡ ì„¤ì • */
        transform: translateX(
          0%
        ); /* âœ… ì´ˆê¸° ìœ„ì¹˜ë¥¼ ê²Œì´ì§€ ë°”ì˜ ì‹œì‘ì ìœ¼ë¡œ ì„¤ì • */
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="score">âœ¨ í™œë™ ì§€í‘œ âœ¨</div>
      <div class="logo"></div>
      <div class="result-container">
        <div class="group" id="ê¸€ìì¸ì‹">
          <div class="group-name">ì½ê¸°</div>
          <div class="progress-bar">
            <div class="progress" id="progress-ê¸€ìì¸ì‹"></div>
            <img
              src="{{ url_for('static', path='images/turtle.png') }}"
              class="gauge-icon"
              id="icon-ê¸€ìì¸ì‹"
              alt="ê¸€ìì¸ì‹ ì•„ì´ì½˜"
            />
          </div>
        </div>

        <div class="group" id="ì“°ê¸°">
          <div class="group-name">ì“°ê¸°</div>
          <div class="progress-bar">
            <div class="progress" id="progress-ì“°ê¸°"></div>
            <img
              src="{{ url_for('static', path='images/turtle.png') }}"
              class="gauge-icon"
              id="icon-ì“°ê¸°"
              alt="ì“°ê¸° ì•„ì´ì½˜"
            />
          </div>
        </div>

        <div class="group" id="ë§í•˜ê¸°">
          <div class="group-name">ë§í•˜ê¸°</div>
          <div class="progress-bar">
            <div class="progress" id="progress-ë§í•˜ê¸°"></div>
            <img
              src="{{ url_for('static', path='images/turtle.png') }}"
              class="gauge-icon"
              id="icon-ë§í•˜ê¸°"
              alt="ë§í•˜ê¸° ì•„ì´ì½˜"
            />
          </div>
        </div>

        <div class="group" id="ì‘ì—…ê¸°ì–µ">
          <div class="group-name">ê¸°ì–µë ¥</div>
          <div class="progress-bar">
            <div class="progress" id="progress-ì‘ì—…ê¸°ì–µ"></div>
            <img
              src="{{ url_for('static', path='images/turtle.png') }}"
              class="gauge-icon"
              id="icon-ì‘ì—…ê¸°ì–µ"
              alt="ì‘ì—…ê¸°ì–µ ì•„ì´ì½˜"
            />
          </div>
        </div>

        <div class="group" id="ì§‘ì¤‘ë ¥">
          <div class="group-name">ì§‘ì¤‘ë ¥</div>
          <div class="progress-bar">
            <div class="progress" id="progress-ì§‘ì¤‘ë ¥"></div>
            <img
              src="{{ url_for('static', path='images/turtle.png') }}"
              class="gauge-icon"
              id="icon-ì§‘ì¤‘ë ¥"
              alt="ì§‘ì¤‘ë ¥ ì•„ì´ì½˜"
            />
          </div>
        </div>
      </div>
      <button
        class="check-btn"
        style="margin-top: 20px; width: 100px; height: 50px; font-size: 1.5rem"
      >
        í™•ì¸
      </button>
    </div>

    <script>
      // âœ… ì•„ì´ì½˜ ì´ë™ ê¸°ëŠ¥ ìˆ˜ì • (ê±°ë¶ì´ê°€ ê²Œì´ì§€ ëê¹Œì§€ ì´ë™)
      function updateGauge(progressId, iconId, percentage, color) {
        const progressEl = document.getElementById(progressId); // .progress ìš”ì†Œ
        const iconEl = document.getElementById(iconId); // .gauge-icon ìš”ì†Œ

        if (progressEl && iconEl) {
          // 1) ê²Œì´ì§€ ì»¬ëŸ¬ ë°” ì„¤ì •
          progressEl.style.width = percentage + "%";
          progressEl.style.backgroundColor = color;

          // 2) ê²Œì´ì§€ê°€ ë Œë”ë§ëœ ë’¤ ì‹¤ì œ ë„ˆë¹„ ê³„ì‚°
          requestAnimationFrame(() => {
            const progressWidth = progressEl.offsetWidth; // ì±„ì›Œì§„ ë°”ì˜ ì‹¤ì œ í”½ì…€ ë„ˆë¹„
            const iconWidth = iconEl.offsetWidth; // ê±°ë¶ì´ ì•„ì´ì½˜ì˜ ë„ˆë¹„

            // 3) ê±°ë¶ì´ ìœ„ì¹˜ ê³„ì‚° (ê±°ë¶ì´ë¥¼ ì»¬ëŸ¬ ë°” ëì— ë§ì¶”ê³  ì‹¶ë‹¤ë©´)
            //    - ì•„ì´ì½˜ì´ ì»¬ëŸ¬ ë°” ëì— ë”± ë§ê²Œ í•˜ë ¤ë©´ progressWidth - iconWidth
            //    - ì•„ì´ì½˜ì„ ì»¬ëŸ¬ ë°” ì¤‘ì•™ì— ì˜¤ê²Œ í•˜ë ¤ë©´ progressWidth - (iconWidth / 2)
            let iconPosition = progressWidth - iconWidth;
            if (iconPosition < 0) iconPosition = 0; // í˜¹ì‹œ ìŒìˆ˜ë©´ 0ìœ¼ë¡œ ë³´ì •

            // 4) ê±°ë¶ì´ ì´ë™
            iconEl.style.transform = `translateX(${iconPosition}px)`;
          });
        }
      }

      // âœ… ê²°ê³¼ ë°ì´í„° í™•ì¸
      async function loadResults() {
        const response = await fetch(
          "https://52.141.27.150/evaluation_results"
        );
        const data = await response.json();
        const results = data.results;

        console.log("ğŸ“Š ê²°ê³¼ ë°ì´í„°:", results); // âœ… ë°ì´í„° í™•ì¸ìš© ì¶œë ¥

        // âœ… ê·¸ë£¹ë³„ ê²Œì´ì§€ ì—…ë°ì´íŠ¸
        results.forEach((result) => {
          const progressBar = document.getElementById(
            `progress-${result.group_name}`
          );
          const icon = document.getElementById(`icon-${result.group_name}`);
          console.log(icon); // âœ… ì½˜ì†”ì— ì•„ì´ì½˜ì´ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸
          if (progressBar && icon) {
            const score = result.score;
            progressBar.style.width = score + "%";
            // progressBar.textContent = score + "%";

            // âœ… ì•„ì´ì½˜ê³¼ ê²Œì´ì§€ ì—…ë°ì´íŠ¸
            updateGauge(
              `progress-${result.group_name}`,
              `icon-${result.group_name}`,
              score,
              score <= 30 ? "lightyellow" : score <= 70 ? "orange" : "green"
            );
          }
        });
      }
      // . ì¶”ê°€!
      document
        .querySelector(".check-btn")
        .addEventListener("pointerdown", () => {
          location.href = "/maintab";
        });

      window.onload = loadResults;
    </script>
  </body>
</html>
